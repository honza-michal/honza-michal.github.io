<!DOCTYPE html>
<html lang="cs" data-theme="light">

    <!-- Injected: set --sidebar-w from localStorage before CSS to avoid first-paint flash -->
    <script>
        // === Bulletproof sidebar width preload ===
        (function () {
            let saved = localStorage.getItem("sidebar.width.px");
            let w = parseInt(saved, 10);
            if (!isFinite(w) || w < 150 || w > window.innerWidth * 0.9) {
                w = 370;
            }
            document.documentElement.style.setProperty("--sidebar-w", w + "px");
        })();
    </script>

    <style>
        html[data-theme='light'],
        body {
            background: #fff;
            color: #000;
        }
    </style>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Studie modularity</title>

    <link rel="stylesheet" href="assets/styles.css" />

</head>

<body>

    <header>

        <!-- DEBUG/DBG global shim: must load before any other scripts -->
        <script>
            (function () {
                try {
                    if (typeof window.DEBUG !== 'boolean') window.DEBUG = false;
                    if (typeof window.DBG !== 'function')
                        window.DBG = function () {
                            if (window.DEBUG) try {
                                console.debug.apply(console, arguments);
                            } catch (e) { }
                        };
                    if (typeof window.DBGW !== 'function')
                        window.DBGW = function () {
                            if (window.DEBUG) try {
                                console.warn.apply(console, arguments);
                            } catch (e) { }
                        };
                } catch (e) { }
            })();
        </script>

        <!--<h1>Studie modularity</h1>-->

        <div style="flex:1"></div>

        <button id="autoFit" hidden>Zobrazit celek - přizpůsobit viditelné ploše</button>

        <label class="themeToggle">
            <input id="themeSwitch" type="checkbox"  class="uiColors" enabled/>
            <span>světlý režim</span>
        </label>

        <button id="exportSVG" data-vis-guard>Export SVG</button>
        <button id="exportPNG" class="primary" data-vis-guard>Export PNG</button>

    </header>

    <div class="layout">

        <!-- ===================== SIDEBAR ===================== -->
        <aside class="sidebar">
			<img src="assets/akk_logo_studie2.svg" alt="AKK logo" id="logo">
            <div class="formcol">
				
                <!-- Project folder -->
                <div class="row" data-vis-guard>
                    <label class="block" style="margin:8px 0; display:block">
                        <div class="dropzone" id="dzProject">
                            <div>
                                <div><strong>Nahraj složku projektu</strong></div>
                                <div class="hint">/assets/bottoms &amp; /assets/tops</div>
                                <div id="projectCounts" class="muted"></div>
                            </div>
                        </div>

                        <input id="pickRoot"
                               type="file"
                               class="visually-hidden-file"
                               multiple
                               webkitdirectory
                               directory />
                    </label>
                </div>

                <!-- Bottom SVG -->
                <div class="row">
                    <label>1. část (spodní) – SVG</label>

                    <div class="dropzone" id="dzBottom">
                        <div>
                            <strong>Přetáhněte SVG</strong>
                            <div class="hint">spodní část</div>
                            <div id="dzBottomMsg" class="muted"></div>
                        </div>
                    </div>

                    <input id="fileL"
                           type="file"
                           accept="image/svg+xml"
                           class="visually-hidden-file" />
                </div>

                <!-- Top SVG -->
                <div class="row">
                    <label>2. část (horní) – SVG</label>

                    <div class="dropzone" id="dzTop">
                        <div>
                            <strong>Přetáhněte SVG</strong>
                            <div class="hint">horní část</div>
                            <div id="dzTopMsg" class="muted"></div>
                        </div>
                    </div>

                    <input id="fileTop"
                           type="file"
                           accept="image/svg+xml"
                           class="visually-hidden-file" />
                </div>
				
                <!-- Bottom / Top selects -->
                <div class="row" data-vis-guard>
                    <h3  class="ctl-label">					
                        VYBERTE SPODNÍ POLOVINU PLÁNU:
						<span class="help-tip" data-tip="Vyberte variantu spodní poloviny plánku. Můžete scrolovat při najetí kurzorem na seznam a v kanvasu se příslušná část zobrazí. Ne všechny horní části jsou se spodními kompatibilní, proto se mohou automaticky měnit i horní části.">?</span>
                    </h3>
					<select id="pickBottom" class="select-pill"></select>

                    <h3  class="ctl-label">
                        VYBERTE KOMPATIBILNÍ HORNÍ POLOVINU PLÁNU:
						<span class="help-tip" data-tip="Vyberte variantu horní obdélníkové části L-kového půdorysu. Můžete scrolovat při najetí kurzorem na drop list a v kanvasu se příslušná část zobrazí.">?</span>
                    </h3>
					<select id="pickTop" class="select-pill"></select>
                </div>
				
                <!-- Cycler -->
                <div class="row" data-vis-guard>
                    <h3  class="ctl-label">
						PROCHÁZENÍ VŠECH KOMPATIBILNÍCH KOMBINACÍ:
						<span class="help-tip" data-tip="Prochází postupně všechny možné kompatibilní kombinace spodních a horních částí, tak jak jdou v seznamech po sobě. Ke každé variantě spodní části existují kompatibilní horní části. Potom co se zobrazí všechny kompatibilní horní části k dané spodní části, zobrazí se další spodní část ze seznamu. PŘEDCHOZÍ a DALŠÍ - Je možné ovládat šipkami.">?</span>
					</h3>
					
                    <div id="cycleGroup" class="segmented two cycle-buttons">
                        <button id="cyclePrev" type="button">←</button>
                        <button id="cycleNext" type="button">→</button>
                    </div>
                </div>

                <!-- Filters ↑↓→←-->
				<hr />
                <div class="row" data-vis-guard>
                    <div class="filters">
						<div class="segmented stack">
							<h3 id = "filter_h3" class="ctl-label">
								FILTROVÁNÍ VÝSLEDKŮ
								<span class="help-tip" data-tip="Zde je možné filtrovat výsledky, tedy omezit seznam možností, které si můžete prohlédnout, pokud máte jasnější představu, co v bungalovu chcete mít.">?</span>
							</h3>
							
							<label class="ctl-label">
								směr vstupu do domu:
								<span class="help-tip" data-tip="např.: šipka zleva doprava znamená že vstup a tedy i zádveří se nachází v levé části půdorysu">?</span>
							</label>
							
							<div id="fEntrance" class="segmented">
								<input id="fEntAny" name="fEntrance" type="radio" value="" checked />
								<label for="fEntAny">bez preference</label>

								<input id="fEntW" name="fEntrance" type="radio" value="vlevo" />
								<label for="fEntW">zleva</label>

								<input id="fEntS" name="fEntrance" type="radio" value="dole" />
								<label for="fEntS">zdola</label>

								<input id="fEntE" name="fEntrance" type="radio" value="vpravo" />
								<label for="fEntE">zprava</label>
							</div>
						</div>
						
						<!--<label class="ctl-label">garáž:</label> -->
						<div id="fRooms" class="segmented stack">
							<input id="fGarage" type="checkbox" />
							<label for="fGarage">pouze s garáží</label>
							
							<label class="ctl-label">
								orientace garáže:
								<span class="help-tip" data-tip="Ukáže jen ty výsledky, kdy je delší strana garáže orientovaná buď svisle či vodorovně na plánku">?</span>
							</label>
							
							<div id="fGarageOrient" class="segmented">
								<input id="fGAny" name="fGarageOrient" type="radio" value="" checked />
								<label for="fGAny">bez preference</label>
								
								<input id="fGV" name="fGarageOrient" type="radio" value="svisle" />
								<label for="fGV">svisle</label>

								<input id="fGH" name="fGarageOrient" type="radio" value="vodorovně" />
								<label for="fGH">vodorovně</label>
							</div>
							
							<label class="ctl-label">
								směr vjezdu do garáže:
								<span class="help-tip" data-tip="Podobně jako vstup do domu, ukáže jen ty výsledky, kdy se vjíždí do garáže ve směru příslušné šipky.">?</span>
							</label>
							
							<div id="fGarageEntrance" class="segmented">
								<input id="fGEAny" name="fGarageEntrance" type="radio" value="" checked />
								<label for="fGEAny">bez preference</label>

								<input id="fGEW" name="fGarageEntrance" type="radio" value="vlevo" />
								<label for="fGEW">zleva</label>

								<input id="fGES" name="fGarageEntrance" type="radio" value="dole" />
								<label for="fGES">zdola</label>

								<input id="fGEE" name="fGarageEntrance" type="radio" value="vpravo" />
								<label for="fGEE">zprava</label>
							</div>
						</div>
						
					<!--<label class="ctl-label">místnosti</label>-->                       
                        <div id="fRooms" class="segmented stack">
						    <input id="fToilet" type="checkbox" />
                            <label for="fToilet">samostatné WC</label>

                            <input id="fLaundry" type="checkbox" />
                            <label for="fLaundry">samostatná prádelna</label>

                            <input id="fFood" type="checkbox" />
                            <label for="fFood">samostatná spíž</label>
                        </div>
                    <div class="filter-actions">
                        <button id="resetFiltry" class="btn full">RESETOVAT FILTRY</button>
                    </div>
                </div>

                <!-- Mirror -->
				<hr />
                <div class="row" data-vis-guard>
                    <h3  class="ctl-label">
                        <input id="mirrorTop" type="checkbox"  class="uiColors"/>
                        ZRCADLIT HORNÍ ČÁST ↔
						<span class="help-tip" data-tip="Ozrcadlí pouze horní část. Hodí se pokud např, chcete mít koupelny záchod atp. blíže u sebe či prohodit místnosti kvůli orientaci vůči světovým stranám na pozemku.">?</span>
                    </h3>
					
                </div>

                <!-- Wardrobe side -->
                <div class="row" data-vis-guard>
                    <h3  class="ctl-label">
						UMÍSTĚNÍ ÚLOŽNÝCH PROSTORŮ NA CHODBĚ ↔
						<span class="help-tip" data-tip="Tyká se především úložných prostorů - skříní v prostoru chodby. Je přednastaveno automaticky, při zaškrtnutí políčka manuálního ovládání je možné úložné prostory přemisťovat z jedné strany na druhou, dle vaších preferencí.">?</span>
					</h3>
                    <div id="wardrobeSwitch" class="segmented two">
                        <input id="wardrobeL" name="wardrobeSide" type="radio" value="left" checked />
                        <label for="wardrobeL">VLEVO</label>

                        <input id="wardrobeR" name="wardrobeSide" type="radio" value="right" />
                        <label for="wardrobeR">VPRAVO</label>
                    </div>
					<h3  class="ctl-label" style="font-size: 0.9em;"> 
                        <input id="wardrobeManual"  class="uiColors" type="checkbox" />
                        ZAPNOUT MANUÁLNÍ PŘEPÍNÁNÍ
						<span class="help-tip" data-tip="Pokud políčko zaškrtete můžete ručně přepínat na jaké straně chodby se úložné prostory nachází. Když není zaškrnuté, tak se zobrazuje automaticky přednastavené zarovnání úložných prostorů a přepínač vlevo - vpravo je vypnutý.">?</span>
                    </h3>
                </div>
				
                <!-- Anchors -->
                <div class="row" data-vis-guard>
				<hr />
                    <h3  class="ctl-label">
                        <input id="showAnchors"  class="uiColors" type="checkbox" />
						<span class="help-tip" data-tip="Zobrazí červený kříž u horní a dolní části, pomocí nichž se obě části pasují na sebe">?</span>
                        ZOBRAZIT KOTVY
                    </h3>
                </div>


                <!-- Scale -->
                <div class="row" data-vis-guard>
                    <h3  class="ctl-label">
                        ZVĚTŠENÍ:
                        <span id="scaleVal">100</span>
                        %
						<span class="help-tip" data-tip="Zvětší obrázek, pokud chcete zvětšení resetovat, můžete použít tlačítko vpravo nahoře">?</span>
                    </h3>
					
                    <input id="scale"
                           type="range"
                           min="10"
                           max="300"
                           step="1"
                           value="100" 
						   class="uiColors"/>
                </div>

            </div>
        </aside>

        <!-- ===================== RESIZER ===================== -->
        <div id="resizer" class="resizer"></div>

        <!-- ===================== PREVIEW ===================== -->
        <main class="preview">

            <div id="scrollMain" class="scrollHost">
                <div class="centerWrap">
                    <div id="stage"></div>
                </div>
            </div>

            <div id="hMirror" class="hMirror">
                <div id="hMirrorInner" class="hMirrorInner"></div>
            </div>

        </main>

    </div>

    <!-- Meta JSON (autogenerated by autoload) -->
    <script id="meta" type="application/json"></script>

    <!-- TEMPDBG overlay will attach itself on load -->
    <script></script>

    <script defer src="src/utils/debugOverlay.js"></script>
    <script type="module" src="src/ui/toolkit.js"></script>
    <script type="module" src="src/boot/main.js"></script>
    <script type="module" src="src/boot/enableSvgPart.js"></script>

</body>
</html>
